require=function c(a,i,s){function l(t,e){if(!i[t]){if(!a[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var r=i[t]={exports:{}};a[t][0].call(r.exports,function(e){return l(a[t][1][e]||e)},r,r.exports,c,a,i,s)}return i[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({Ball:[function(e,t,o){"use strict";cc._RF.push(t,"69862Pi63FOwZE7Ovc6YDR7","Ball"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Game"),r=cc._decorator,c=r.ccclass,a=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(e){this.node.getWorldPosition().y<0&&(this.node.destroy(),n.default.activeBalls--)},t=__decorate([c],t)}(cc.Component));o.default=a,cc._RF.pop()},{"./Game":"Game"}],Block:[function(e,t,o){"use strict";cc._RF.push(t,"bb2bc9N6ENAoIjEdtZMxn/z","Block"),Object.defineProperty(o,"__esModule",{value:!0});var c=e("./Game"),n=cc._decorator,a=n.ccclass,i=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.countLabel=null,e._count=1,e}return __extends(e,t),r=e,Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(e){0===e&&this.node.destroy(),this._count=e,this.countLabel.string=e.toString()},enumerable:!0,configurable:!0}),e.prototype.onBeginContact=function(e,t,o){if(this.count--,c.default.score++,this.node.dispatchEvent(new cc.Event.EventCustom(r.BLOCK_HIT_EVENT,!0)),!(0<this.node.getNumberOfRunningActions())){var n=cc.repeat(cc.sequence(cc.moveBy(.05,cc.v2(5,5)),cc.moveBy(.05,cc.v2(-5,-5))),5);this.node.runAction(n)}},e.BLOCK_HIT_EVENT="BlockHitEvent",__decorate([i(cc.Label)],e.prototype,"countLabel",void 0),__decorate([i],e.prototype,"_count",void 0),e=r=__decorate([a],e);var r}(cc.Component);o.default=r,cc._RF.pop()},{"./Game":"Game"}],Canvas:[function(e,t,o){"use strict";cc._RF.push(t,"9547c0nA4JAbaoK+/Ku1bLF","Canvas"),Object.defineProperty(o,"__esModule",{value:!0});var c=e("./Block"),n=e("./FBService"),r=e("./Game"),a=cc._decorator,i=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aim=null,e.ballPrefab=null,e.scoreLabel=null,e.personalBestLabel=null,e.currentScoreLabel=null,e.resultLabel=null,e.ballsLabel=null,e.starsParticlePrefab=null,e.shapePrefabs=[],e.overlay=null,e.oScoreLabel=null,e.oRankLabel=null,e.oChallengeButton=null,e.oRewardAdButton=null,e.tutorial=null,e.avatar=null,e.hitAudio=null,e._adInstance=null,e._lastScore=0,e._currentScore=0,e._shapes=[],e._seq=0,e._plusOneCount=0,e._leaderboardRank=0,e._leaderboardScore=0,e._audioBus=[],e._newHighScore=!1,e._debugTouch={count:0,lastTouch:0},e}return __extends(e,t),e.prototype.shareFB=function(){var o=this;n.default.isFB()&&cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){var e=cc.game.canvas.toDataURL();cc.director.off(cc.Director.EVENT_AFTER_DRAW);var t=0<o._leaderboardRank?" (personal best: "+o._leaderboardScore+", #"+o._leaderboardRank+" globally)":"";n.default.FBInstant().shareAsync({intent:"CHALLENGE",image:e,text:"I've scored "+r.default.score+t+" in Pinball Breakout, can you beat me?"}).then(function(){o.overlay.active=!1,o.oChallengeButton.active=!1,o._showStarsParticle(),o._showResult("Continue!",1),o._adInstance&&(o.oRewardAdButton.active=!0),o._continue()})})},e.prototype.restart=function(){r.resetGame(),cc.director.loadScene("main")},e.prototype.showAd=function(){var t=this;this._adInstance&&this._adInstance.showAsync().then(function(){t.overlay.active=!1,t.oRewardAdButton.active=!1,t._showStarsParticle(),t._showResult("Continue!",1),t._continue()}).catch(function(e){alert(e.message),t.restart()})},e.prototype.onLoad=function(){var o=this;this.overlay.zIndex=2,this._initFBInstant(),n.default.preloadAd().then(function(e){return o._adInstance=e}),n.default.getScore().then(function(e){e?(o._leaderboardRank=e.rank,o._leaderboardScore=e.score,o._updatePersonalBestLabel()):o.personalBestLabel.node.active=!1}),this.node.on(cc.Node.EventType.TOUCH_START,function(e){o.tutorial.active=!1,o.aim.lookAt(cc.v2(e.getLocation()))}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){o.aim.lookAt(cc.v2(e.getLocation()))}),this.node.on(c.default.BLOCK_HIT_EVENT,function(){2<=o._audioBus.length&&cc.audioEngine.stop(o._audioBus.shift());var t=cc.audioEngine.play(o.hitAudio.toString(),!1,.5);cc.audioEngine.setFinishCallback(t,function(){o._audioBus=o._audioBus.filter(function(e){return e!==t})}),o._audioBus.push(t)}),this.node.on(cc.Node.EventType.TOUCH_END,function(e){if(!(0<r.default.activeBalls)){var t=cc.v2(e.getLocation());o._fire(t),2<=r.default.balls&&o.schedule(function(){o._fire(t)},.25,r.default.balls-2)}})},e.prototype.update=function(e){if(this.ballsLabel.string="Ball: "+r.default.balls.toString(),0<r.default.activeBalls){if(this.aim.active=!1,r.default.score-this._lastScore>this._currentScore){if(this._currentScore=r.default.score-this._lastScore,this.currentScoreLabel.node.active=!0,this.currentScoreLabel.string="+"+this._currentScore,0<this.currentScoreLabel.node.getNumberOfRunningActions())return;this.currentScoreLabel.node.runAction(cc.sequence(cc.scaleTo(.25,1.2),cc.scaleTo(.25,1)))}}else if(!this.aim.active){if(this._lastScore!==r.default.score){var t=r.default.score-this._lastScore,o=r.default.score/this._seq;r.default.score>this._leaderboardScore&&!this._newHighScore?(this._newHighScore=!0,this._showStarsParticle(),this._showResult("New High Score!")):2*o<=t?(this._showStarsParticle(),this._showResult("Incredible!")):1.5*o<=t?(this._showStarsParticle(),this._showResult("Excellent!")):1.25*o<=t?this._showResult("Well Done!"):1*o<=t&&this._showResult("Good Effort!"),this._showScoreAnimation(),this._lastScore=r.default.score}this._shiftAndGenerateShapes(),this.scoreLabel.string="Score: "+r.default.score.toString(),r.default.score>this._leaderboardScore&&(this._leaderboardScore=r.default.score,this._updatePersonalBestLabel(),n.default.setScore(this._leaderboardScore)),this.currentScoreLabel.node.active=!1,this.aim.active=!0,this._currentScore=0}},e.prototype._updatePersonalBestLabel=function(){0<this._leaderboardScore&&(this.personalBestLabel.node.active=!0),this.personalBestLabel.string="Personal Best: "+this._leaderboardScore},e.prototype._continue=function(){var n=[];this._shapes.forEach(function(e,t,o){300<e.position.y?e.destroy():n.push(e)}),this._shapes=n},e.prototype._gameOver=function(){var o=this;this.overlay.active=!0,this.oScoreLabel.string=r.default.score.toString(),this.oRankLabel.string="Loading your rank...",n.default.setScore(r.default.score).then(function(e){var t="Personal Best: "+e.score;e.rank&&(t+=" (#"+e.rank+" Globally)"),o.oRankLabel.string=t,o._leaderboardRank=e.rank,o._leaderboardScore=e.score})},e.prototype._initFBInstant=function(){var o=this;n.default.isFB()&&(this.avatar.node.active=!0,this.oChallengeButton.active=!0,cc.loader.load(n.default.FBInstant().player.getPhoto(),function(e,t){o.avatar.spriteFrame=new cc.SpriteFrame(t)}))},e.prototype._shiftAndGenerateShapes=function(){var n=this;if(this._seq++,this._shapes=this._shapes.filter(function(e){return cc.isValid(e)}),0!==this._shapes.length){var r=0,c=!1;this._shapes.forEach(function(e,t,o){e.runAction(cc.sequence(cc.moveBy(.25,cc.v2(0,100)),cc.callFunc(function(){if(450<e.position.y)return c||n._gameOver(),void(c=!0);300<e.position.y&&e.runAction(cc.blink(.5,3)),++r===o.length&&n._generateShapes()})))})}else this._generateShapes()},e.prototype._generateShapes=function(){for(var e=Math.ceil(7*Math.random()),t=1;t<=7;t++){var o=this._randomShape();if("PlusOne"===o.name){if(this._plusOneCount*this._plusOneCount>this._seq)continue;this._plusOneCount++}else if(.25<Math.random()&&t!==e)continue;var n=cc.instantiate(o);n.position=cc.v2(90*(t-.5)-this.node.width/2,20+n.height/2-this.node.height/2),n.rotation=50*(Math.random()-.5);var r=n.getComponent(c.default);r&&(r.count=Math.ceil(4*this._seq*Math.random())),n.parent=this.node,this._shapes.push(n)}},e.prototype._randomShape=function(){return this.shapePrefabs[Math.floor(Math.random()*this.shapePrefabs.length)]},e.prototype._showScoreAnimation=function(){var e=cc.instantiate(this.currentScoreLabel.node);e.parent=this.node,e.runAction(cc.sequence(cc.spawn(cc.moveTo(.25,this.scoreLabel.node.position),cc.fadeOut(.3),cc.scaleTo(.25,.5)),cc.callFunc(function(){e.destroy()})))},e.prototype._showStarsParticle=function(){var e=cc.instantiate(this.starsParticlePrefab);e.position=cc.v2(0,568),e.parent=this.node},e.prototype._showResult=function(e,t){void 0===t&&(t=.5),this.resultLabel.string=e,this.resultLabel.node.runAction(cc.sequence(cc.fadeIn(.25),cc.delayTime(t),cc.fadeOut(.25)))},e.prototype._fire=function(e){var t=cc.instantiate(this.ballPrefab),o=t.getComponent(cc.RigidBody);t.parent=this.node,t.position=this.aim.position,o.linearVelocity=e.sub(this.aim.getWorldPosition()).normalize().mul(2e3),r.default.activeBalls++},__decorate([s(cc.Node)],e.prototype,"aim",void 0),__decorate([s(cc.Prefab)],e.prototype,"ballPrefab",void 0),__decorate([s(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([s(cc.Label)],e.prototype,"personalBestLabel",void 0),__decorate([s(cc.Label)],e.prototype,"currentScoreLabel",void 0),__decorate([s(cc.Label)],e.prototype,"resultLabel",void 0),__decorate([s(cc.Label)],e.prototype,"ballsLabel",void 0),__decorate([s(cc.Prefab)],e.prototype,"starsParticlePrefab",void 0),__decorate([s([cc.Prefab])],e.prototype,"shapePrefabs",void 0),__decorate([s(cc.Node)],e.prototype,"overlay",void 0),__decorate([s(cc.Label)],e.prototype,"oScoreLabel",void 0),__decorate([s(cc.Label)],e.prototype,"oRankLabel",void 0),__decorate([s(cc.Node)],e.prototype,"oChallengeButton",void 0),__decorate([s(cc.Node)],e.prototype,"oRewardAdButton",void 0),__decorate([s(cc.Node)],e.prototype,"tutorial",void 0),__decorate([s(cc.Sprite)],e.prototype,"avatar",void 0),__decorate([s(cc.AudioClip)],e.prototype,"hitAudio",void 0),e=__decorate([i],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./Block":"Block","./FBService":"FBService","./Game":"Game"}],Config:[function(e,t,o){"use strict";cc._RF.push(t,"2d0255wwDhDJ4yrOjGdnvcw","Config"),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().debugDrawFlags=0,cc.director.getCollisionManager().enabled=!0,cc._RF.pop()},{}],Extensions:[function(e,t,o){"use strict";cc._RF.push(t,"168ae5Fcz9Eeqxoba4/sf3T","Extensions"),cc.Node.prototype.getWorldPosition=function(){return this.parent.convertToWorldSpaceAR(this.getPosition())},cc.Node.prototype.lookAt=function(e){var t=cc.pToAngle(e.sub(this.getWorldPosition()));this.rotation=180*-t/Math.PI},cc._RF.pop()},{}],FBService:[function(e,t,o){"use strict";cc._RF.push(t,"345ddf73tFBcLXND5SsE7SX","FBService"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.FBInstant=function(){return this.isFB()?FBInstant:{}},e.isFB=function(){return"undefined"!=typeof FBInstant},e.setScore=function(t){if(this.isFB())return FBInstant.getLeaderboardAsync("Global Leaderboard").then(function(e){return e.setScoreAsync(t)}).then(function(e){return{rank:e.getRank(),score:e.getScore()}});var e=cc.sys.localStorage.getItem("personalBest");return(!e||e<t)&&(e=t),cc.sys.localStorage.setItem("personalBest",e),Promise.resolve({rank:null,score:e})},e.getScore=function(){if(this.isFB())return FBInstant.getLeaderboardAsync("Global Leaderboard").then(function(e){return e.getPlayerEntryAsync()}).then(function(e){return e?{rank:e.getRank(),score:e.getScore()}:null});var e=cc.sys.localStorage.getItem("personalBest");return e?Promise.resolve({rank:null,score:e}):Promise.resolve(null)},e.preloadAd=function(){var t=null;return this.isFB()?FBInstant.getRewardedVideoAsync("198493907436001_200991730519552").then(function(e){return(t=e).loadAsync()}).then(function(){return t}):Promise.resolve(t)},e}();o.default=n,cc._RF.pop()},{}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"fd1f9ETXHdLGp58m+mZAmx/","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n={activeBalls:0,balls:1,score:0},r=Object.assign({},n);o.resetGame=function(){Object.assign(r,n)},o.default=r,cc._RF.pop()},{}],PlusOne:[function(e,t,o){"use strict";cc._RF.push(t,"6d9eaXL0U5O8q4Ci5+k3sMs","PlusOne"),Object.defineProperty(o,"__esModule",{value:!0});var c=e("./Game"),n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isDone=!1,e}return __extends(e,t),e.prototype.onEndContact=function(e,t,o){if(!this._isDone){this._isDone=!0;var n=cc.instantiate(o.node),r=n.getComponent(cc.RigidBody);r.linearVelocity=cc.v2(-r.linearVelocity.x,r.linearVelocity.y),n.parent=this.node.parent,c.default.activeBalls++,c.default.balls++,c.default.score++,this.node.destroy()}},e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{"./Game":"Game"}]},{},["Ball","Block","Canvas","Config","Extensions","FBService","Game","PlusOne"]);